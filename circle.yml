machine:
  pre:
    - sudo curl -L -o /usr/bin/docker 'https://s3-external-1.amazonaws.com/circle-downloads/docker-1.9.1-circleci'
    - sudo chmod 0755 /usr/bin/docker
  environment:
    SECRET_KEY: CI
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker"
  pre:
    - mkdir -p $HOME/docker
    - docker load --input $HOME/docker/cache.tar || true
    - pip install docker-compose 
    - pip install requests
  override:
    - docker-compose -f dockereve-master/docker-compose.yml pull
    - docker-compose -f dockereve-master/docker-compose.yml build
    - docker save -o $HOME/docker/cache.tar eve:latest python:3.4-onbuild tutum/nginx:latest mongo:latest

test:
  override:
    - docker-compose -f dockereve-master/docker-compose.yml up -d && sleep 15
    - python test/testGetPost.py
